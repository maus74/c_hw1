/*
  Условие ИЗ№1:
Создать структуру для хранения информации о проекте разработки: 
 дате его начала и окончания, наименовании проекта и разрабатываемой системы, приоритете проекта, имени руководителя и т.д. 
 Составить с ее использованием программу вывода информации обо всех проектах, закрытие которых планируется в текущем квартале, 
 с группировкой по приоритету проекта.
 */

#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <assert.h>
#include <errno.h>

struct Project {
    char* startTime;
    char* endTime;
    char* Name;
    char* SystemName;
    char* boss;
    char* priority;
};
#define Project struct Project

struct Data {
    Project** data;
    int* size;
    int* index;

};
#define Data struct Data
void init_data(Data* val) {
    val->size = calloc(3, sizeof(int));
    val->index = calloc(3, sizeof(int));
    for(int i = 0; i < 3; i++) {
        val->size[i] = 3;
    }
    val->data = (Project**)malloc(sizeof(Project*) * 3);
    for(int i = 0; i < 3; i++) {
        val->data[i] = (Project*)malloc(sizeof(Project) * 2);
    }
}

void resize_db(Data* val, int id)
{
    val->size[id] *= 2;
    Project* temp = (Project*)realloc(val->data[id], val->size[id] * sizeof(Project));
    if(temp != NULL) {
        free(val->data[id]);
        val->data[id] = temp;
    }

}

void resize_pr(Project* val, int* new_size)
{
    val = (Project*)realloc(val, sizeof(Project) * *new_size);
}

void insert(Data* val, Project* cur)
{

        if(cur->priority == "small") {
            if (val->size[0] == val->index[0]+1)
                resize_db(val, (int)0);
            val->data[0][val->index[0]] = *cur;
            val->index[0]++;
        }
        if(cur->priority == "medium") {
            if (val->size[1] == val->index[1]+1)
                resize_db(val, (int)1);
            val->data[1][val->index[1]] = *cur;
            val->index[1]++;
        }
        if(cur->priority == "high") {
            if (val->size[2] == val->index[2]+1)
                resize_db(val, (int)2);
            val->data[2][val->index[2]] = *cur;
            val->index[2]++;
        }

}

int date_to_quarter(char* date)
{
    char* buf = (char*)malloc(2 * sizeof(char));
    if(buf != NULL) {
        buf[0] = date[3];
        buf[1] = date[4];
        int mounth, ans;
        if (buf[0] == '0') {
            mounth = atoi(&buf[1]);
            if (1 <= mounth && mounth <= 3)
                ans = 1;
            if (4 <= mounth && mounth <= 6)
                ans = 2;
            if (7 <= mounth && mounth <= 9)
                ans = 3;
        } else {
            mounth = atoi(buf);
            if (10 <= mounth && mounth <= 12)
                ans = 4;
        }
        free(buf);
        return ans;
    }
    else {
        assert(1 == 0);
    }

}

void selection(Data* val,char* date)
{
    Project *sel = malloc(sizeof(Project) * 2);
    int index = 0;
    int size = 2;
    int sr = date_to_quarter(date);
    for(int i = 2;i >= 0; i--) {
       for(int j = 0; j < val->index[i]; j++) {
           if(date_to_quarter(val->data[i][j].endTime) == sr) {
               if(index != size) {
                   sel[index] = val->data[i][j];
                   index++;
               }
               else {
                   size *= 2;
                   resize_pr(sel, &size);
                   sel[index] = val->data[i][j];
                   index++;
               }
           }
       }
    }

    if(!index) {
        printf("NONE");
        printf("\n");
    }
    else {
        printf("%s\n%s\n%s\n%s\n%s\n%s\n",sel[0].Name,sel[0].priority,sel[0].SystemName,sel[0].boss,sel[0].startTime,sel[0].endTime);
        printf("\n");
    }
    for(int i = 1; i < index; i++) {
        printf("%s\n%s\n%s\n%s\n%s\n%s\n",sel[i].Name,sel[i].priority,sel[i].SystemName,sel[i].boss,sel[i].startTime,sel[i].endTime);
        printf("\n");
    }
    free(sel);

}



int main() {
    printf("Hello, World!\n");

    Data data;
    init_data(&data);



    Project val2 = {
            "12.04.2012",
            "15.05.2016",
            "newpr",
            "setinfo4",
            "i",
            "medium"
    };



    Project val3 = {
            "12.04.2012",
            "15.05.2016",
            "newpr",
            "setinfo3",
            "i",
            "small"
    };

    Project val4 = {
            "12.04.2012",
            "15.12.2016",
            "newpr",
            "setinfo2",
            "i",
            "small"
    };

    Project val5 = {
            "12.04.2012",
            "15.12.2016",
            "newpr",
            "setinfo1",
            "i",
            "small"
    };

    insert(&data, &val2);

    insert(&data, &val3);

    insert(&data, &val4);

    insert(&data, &val5);

    char str[] = "15.12.2016";

    selection(&data, &str);

    char str1[] = "15.05.2016";

    selection(&data, &str1);

    return 0;
}
